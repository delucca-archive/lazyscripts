#if 0
	shc Version 3.9.6, Generic Shell Script Compiler
	GNU GPL Version 3 Md Jahidul Hamid <jahidulhamid@yahoo.com>

	shc -f src/commands/bootstrap-codespaces/bootstrap-codespaces.sh -o bin/bootstrap-codespaces 
#endif

static  char data [] = 
#define      rlax_z	1
#define      rlax	((&data[0]))
	"\301"
#define      shll_z	10
#define      shll	((&data[2]))
	"\217\137\130\007\370\315\033\154\175\124\105"
#define      msg2_z	19
#define      msg2	((&data[12]))
	"\255\205\021\100\265\143\224\302\246\270\223\202\141\165\004\123"
	"\016\113\324\310\036\274"
#define      opts_z	1
#define      opts	((&data[34]))
	"\075"
#define      date_z	1
#define      date	((&data[35]))
	"\120"
#define      text_z	3152
#define      text	((&data[560]))
	"\353\363\142\031\072\310\002\042\065\274\045\147\364\232\157\204"
	"\066\224\112\376\262\006\273\334\115\340\056\272\251\330\310\224"
	"\313\052\256\005\363\261\050\050\156\115\217\142\350\377\346\036"
	"\223\061\034\105\070\330\042\205\271\120\100\142\051\010\367\364"
	"\063\246\372\046\127\042\117\305\160\337\047\130\336\016\167\161"
	"\077\223\266\167\154\331\375\046\051\075\211\122\106\201\107\171"
	"\047\101\240\177\144\357\104\324\316\154\054\254\173\243\036\272"
	"\067\325\062\244\256\057\313\327\155\124\052\263\326\161\055\375"
	"\263\316\174\027\275\301\353\214\056\030\071\251\274\127\144\364"
	"\054\226\230\332\306\144\262\063\271\334\347\217\116\025\214\001"
	"\343\011\031\240\313\004\054\371\035\146\243\331\275\007\315\351"
	"\235\146\304\143\312\167\227\203\123\176\022\242\223\237\244\166"
	"\251\275\027\165\301\104\157\337\252\022\270\147\031\206\121\267"
	"\354\026\033\267\215\262\073\341\061\116\203\304\356\047\073\230"
	"\344\122\015\246\227\174\205\101\217\076\251\251\304\373\141\261"
	"\021\174\151\237\057\244\200\140\363\004\045\341\053\141\171\020"
	"\263\207\267\113\004\075\214\223\173\065\075\100\061\236\362\102"
	"\033\133\341\112\000\142\253\363\146\321\324\222\062\116\242\346"
	"\325\132\061\332\227\276\156\022\364\253\123\045\112\105\150\145"
	"\240\112\260\240\254\134\224\022\055\150\245\140\267\110\106\215"
	"\242\170\147\071\066\325\114\052\201\237\120\313\345\270\061\205"
	"\002\341\046\257\075\272\302\153\043\147\313\333\257\022\150\122"
	"\213\320\214\301\246\330\354\047\170\075\363\135\365\044\343\370"
	"\006\012\250\104\305\152\257\350\322\173\303\201\215\054\324\031"
	"\375\140\332\243\071\307\313\261\004\276\017\372\343\363\363\351"
	"\375\233\055\302\006\335\253\330\130\157\132\346\234\056\377\231"
	"\216\332\074\307\241\010\171\246\307\211\241\252\175\225\223\172"
	"\060\301\075\067\236\351\017\366\130\151\335\364\230\334\216\047"
	"\267\313\357\131\323\151\377\232\362\241\104\157\066\330\352\147"
	"\231\050\236\070\022\256\057\153\027\014\137\260\351\356\327\240"
	"\271\307\371\214\060\371\046\043\232\153\222\321\103\175\070\335"
	"\246\327\025\270\205\104\043\235\121\203\115\072\161\045\332\052"
	"\354\323\267\034\314\336\077\147\111\322\070\214\225\276\032\145"
	"\044\232\322\260\322\163\340\212\315\113\027\364\351\020\323\143"
	"\313\332\010\273\117\153\127\222\227\367\003\165\057\307\066\015"
	"\353\346\277\062\073\074\344\342\023\233\327\226\310\125\363\054"
	"\032\170\127\263\064\231\326\133\073\343\253\012\110\356\070\161"
	"\072\037\257\336\102\006\212\265\257\371\137\364\371\233\365\120"
	"\304\246\175\001\177\015\331\227\002\007\311\347\346\147\046\154"
	"\334\127\170\050\140\357\065\221\032\354\217\151\203\107\263\365"
	"\226\075\377\235\355\137\263\042\172\353\324\002\305\205\142\271"
	"\157\174\200\066\244\363\050\041\013\112\011\362\230\117\351\343"
	"\125\111\107\221\265\112\244\022\022\336\375\377\024\303\035\041"
	"\133\131\273\242\261\375\026\174\200\131\131\310\115\055\340\300"
	"\313\330\263\004\073\101\352\155\031\112\370\173\065\302\130\133"
	"\011\326\261\333\064\237\241\350\057\173\130\332\100\117\220\005"
	"\045\363\372\354\245\172\370\010\335\022\254\172\151\021\266\074"
	"\006\163\100\052\203\026\060\077\021\330\154\315\174\173\035\211"
	"\341\323\035\042\327\016\271\152\251\265\334\143\145\133\050\314"
	"\327\361\320\324\225\342\204\030\270\342\343\102\242\374\342\007"
	"\343\350\267\020\203\367\160\323\371\163\131\357\046\023\204\145"
	"\333\377\063\367\006\045\302\115\351\045\241\147\077\227\060\045"
	"\316\122\217\247\215\025\275\323\131\103\061\006\177\007\002\345"
	"\063\244\104\224\006\056\323\050\055\071\212\126\173\111\246\124"
	"\342\120\155\104\132\054\370\145\235\306\351\024\066\017\172\346"
	"\057\057\160\206\322\315\174\223\031\121\347\061\325\172\057\254"
	"\202\212\223\204\370\334\202\062\161\070\120\332\222\232\242\061"
	"\352\243\034\001\105\025\367\017\155\352\015\077\144\230\152\104"
	"\043\051\067\346\055\363\345\025\140\345\364\013\362\366\140\043"
	"\037\334\145\213\246\230\350\230\355\353\350\274\174\135\330\241"
	"\325\042\226\013\131\034\244\101\154\160\115\367\324\257\167\042"
	"\130\012\254\277\210\052\165\244\331\242\057\233\213\164\372\121"
	"\111\270\367\102\211\111\063\152\242\125\333\131\066\060\033\210"
	"\375\242\215\365\011\230\103\141\244\072\161\037\165\033\060\255"
	"\147\124\155\251\023\335\307\017\172\000\261\273\356\156\031\100"
	"\225\156\047\304\054\336\273\351\340\203\107\332\333\242\107\136"
	"\102\227\301\130\332\350\366\105\274\044\225\233\261\202\252\073"
	"\376\024\120\276\016\146\017\020\070\232\316\213\273\325\356\057"
	"\070\046\157\131\327\274\222\211\042\143\065\221\171\052\156\276"
	"\157\037\112\017\210\245\373\274\377\341\130\227\240\266\106\137"
	"\204\067\036\241\371\262\301\247\365\047\310\316\052\275\162\030"
	"\135\116\030\370\072\063\321\147\361\153\157\342\277\364\200\155"
	"\007\377\261\175\073\006\020\077\031\213\245\332\006\211\267\216"
	"\104\045\150\204\027\042\073\334\262\230\161\013\320\054\333\251"
	"\312\313\310\230\102\054\021\237\064\023\021\336\155\166\121\345"
	"\074\007\240\220\001\275\202\353\044\374\375\200\203\013\352\347"
	"\176\126\300\070\322\163\244\334\266\135\000\266\031\030\253\276"
	"\161\361\221\121\310\167\246\164\075\143\337\161\202\100\314\356"
	"\056\242\005\131\374\225\116\363\203\072\142\222\305\160\350\121"
	"\012\115\054\054\222\220\053\123\370\260\055\377\043\154\302\301"
	"\004\027\377\115\261\052\210\242\373\251\012\051\217\022\256\340"
	"\300\327\304\260\250\116\310\005\044\300\165\073\273\355\124\053"
	"\061\254\254\311\172\206\071\244\257\101\134\020\153\145\010\166"
	"\124\260\046\244\024\011\340\005\056\212\236\012\056\024\247\332"
	"\176\232\320\151\163\375\244\343\226\246\372\232\262\224\350\216"
	"\302\265\372\113\017\340\061\323\221\332\001\371\075\037\136\177"
	"\116\050\204\176\225\150\220\201\066\162\253\151\201\220\004\135"
	"\074\064\321\323\156\062\257\253\371\023\066\111\204\252\022\233"
	"\221\323\340\135\252\015\266\164\222\303\162\011\037\016\155\075"
	"\361\372\255\167\154\027\107\122\015\147\010\156\013\366\140\061"
	"\037\324\072\222\031\165\254\053\232\307\002\206\167\252\113\001"
	"\377\236\202\312\237\101\176\116\245\043\064\154\164\161\351\215"
	"\055\253\341\020\231\072\030\135\100\154\373\206\131\254\140\100"
	"\175\243\350\200\350\037\343\306\152\076\071\272\144\105\300\077"
	"\026\153\363\247\146\061\206\342\360\015\343\347\315\253\107\352"
	"\274\252\101\142\041\050\366\336\064\233\224\030\175\067\255\252"
	"\071\150\345\043\250\345\031\341\121\264\237\160\374\145\275\005"
	"\026\327\232\335\163\242\140\227\174\103\161\274\257\051\371\243"
	"\017\217\161\315\356\227\031\063\020\073\040\136\005\077\262\036"
	"\331\063\011\050\223\171\071\264\161\133\054\325\367\346\004\124"
	"\267\041\256\261\122\142\223\251\036\077\361\144\374\254\112\374"
	"\140\165\221\337\174\263\203\313\114\257\304\255\363\244\017\326"
	"\232\247\315\052\001\207\101\374\111\367\027\163\116\267\114\366"
	"\006\244\175\275\235\356\302\271\033\126\233\324\212\323\241\204"
	"\007\166\137\172\331\304\110\341\224\047\317\143\057\304\122\043"
	"\333\225\270\311\070\324\006\016\004\213\043\307\233\275\373\017"
	"\262\031\304\125\125\241\156\244\343\314\327\007\247\163\227\207"
	"\365\152\004\313\340\306\354\246\214\046\244\137\063\316\133\345"
	"\342\244\214\135\241\251\062\103\076\046\345\146\253\126\141\016"
	"\301\342\024\103\011\376\210\120\332\312\120\176\240\334\235\174"
	"\215\312\212\020\251\302\321\335\236\130\120\051\327\062\355\230"
	"\054\005\321\213\354\042\206\307\026\162\011\331\377\245\232\337"
	"\033\264\131\326\355\242\270\045\124\276\057\074\146\144\126\116"
	"\273\110\051\152\057\274\030\312\320\370\334\056\273\053\205\147"
	"\237\115\304\361\064\266\045\063\125\237\027\233\303\251\014\227"
	"\005\255\060\317\336\013\310\035\077\303\165\321\036\251\317\040"
	"\200\171\171\164\345\375\032\240\366\367\324\374\024\027\223\316"
	"\327\141\015\342\120\130\023\344\232\261\332\061\377\313\067\167"
	"\042\017\277\237\360\233\104\115\305\070\207\351\076\035\306\263"
	"\310\253\225\211\122\377\062\042\007\377\002\367\066\225\236\223"
	"\167\140\255\200\351\276\266\122\304\223\030\051\236\022\071\271"
	"\325\206\105\262\067\267\020\067\261\335\000\210\144\052\347\111"
	"\304\071\144\073\271\014\042\240\170\025\310\121\027\272\050\363"
	"\363\132\216\043\165\371\102\142\027\073\325\132\346\367\376\062"
	"\026\363\276\203\152\053\055\124\067\227\044\066\151\162\011\072"
	"\027\360\321\146\226\245\361\331\070\377\057\134\272\333\212\216"
	"\020\053\271\320\165\206\161\054\166\177\151\347\143\031\220\065"
	"\356\261\046\114\224\077\074\075\127\036\043\325\316\155\230\140"
	"\236\325\344\151\333\136\215\226\310\122\165\123\231\346\107\241"
	"\200\211\146\110\013\110\325\234\070\267\354\217\273\065\101\300"
	"\340\152\313\060\267\024\160\374\124\055\066\146\345\150\052\215"
	"\156\134\165\111\055\166\032\064\014\051\222\076\034\044\311\222"
	"\155\010\031\034\245\221\350\061\303\242\121\163\075\254\275\152"
	"\164\317\301\122\115\055\200\143\346\161\335\234\363\042\311\044"
	"\312\204\131\222\256\137\034\015\071\077\014\332\124\165\070\263"
	"\053\015\165\171\161\222\117\357\214\367\363\074\270\170\341\312"
	"\155\271\307\377\326\024\136\154\206\175\332\224\052\010\362\307"
	"\101\244\046\036\246\057\074\051\350\045\126\227\054\157\371\107"
	"\033\100\242\230\303\124\344\345\252\353\230\340\272\076\333\055"
	"\316\373\172\225\264\025\300\231\077\037\050\212\072\362\111\011"
	"\260\037\175\200\261\337\022\135\326\260\152\132\044\233\042\035"
	"\126\322\370\050\223\260\231\140\117\035\065\351\016\256\333\075"
	"\026\336\201\051\324\072\046\016\160\325\107\232\002\162\321\100"
	"\364\262\330\306\237\012\060\320\321\230\215\024\346\305\304\327"
	"\177\207\375\347\330\160\006\102\056\163\041\231\145\324\024\233"
	"\014\116\105\247\213\056\024\330\100\143\272\344\201\367\325\117"
	"\374\027\331\212\145\036\100\010\034\010\034\252\272\141\327\370"
	"\260\342\160\302\336\205\265\273\230\000\006\156\357\255\206\302"
	"\303\312\105\314\213\207\373\001\000\362\152\237\245\276\134\103"
	"\133\216\137\143\332\307\333\164\235\041\055\037\002\352\111\344"
	"\320\232\350\023\121\004\045\174\027\007\153\342\215\304\113\005"
	"\064\134\017\021\377\170\202\110\162\165\323\212\072\315\353\073"
	"\213\264\152\052\036\066\004\342\160\104\032\306\147\225\353\344"
	"\326\333\026\120\013\117\341\267\104\005\330\205\361\032\324\256"
	"\333\140\311\067\161\067\044\330\106\336\041\116\127\217\344\306"
	"\135\166\156\131\305\024\103\200\136\014\206\113\062\254\073\250"
	"\050\031\052\210\342\212\220\014\067\042\111\257\231\213\224\140"
	"\305\260\066\310\124\067\014\105\310\221\025\343\141\054\217\021"
	"\171\070\220\264\231\264\320\344\005\130\244\132\213\114\246\161"
	"\166\013\354\032\107\366\000\315\315\226\001\161\116\144\063\143"
	"\222\067\131\256\000\233\255\216\155\240\347\027\021\220\326\124"
	"\271\322\311\175\175\274\076\334\304\321\104\135\231\141\013\057"
	"\155\262\330\045\320\331\347\272\324\167\046\070\107\305\106\273"
	"\262\116\177\110\030\147\153\160\220\137\043\275\026\324\001\071"
	"\053\316\267\272\340\314\307\072\124\305\364\111\366\032\233\104"
	"\033\210\322\006\165\322\112\310\262\171\210\074\305\345\351\367"
	"\170\347\224\121\322\036\202\252\326\152\261\306\204\236\162\075"
	"\166\213\364\061\135\062\315\101\217\143\032\332\277\374\006\355"
	"\164\057\325\257\261\310\137\230\273\335\042\277\217\277\022\055"
	"\005\062\156\077\321\313\050\366\054\024\320\262\373\071\063\266"
	"\140\033\225\025\036\072\237\165\106\011\215\104\230\176\161\147"
	"\073\272\123\032\065\225\357\372\230\267\057\024\077\147\120\263"
	"\263\361\352\257\110\267\121\257\066\272\017\214\034\247\205\310"
	"\134\302\222\240\100\275\320\214\071\274\324\135\265\131\274\270"
	"\067\264\076\141\070\252\271\075\140\025\010\176\012\046\113\237"
	"\314\374\017\104\224\026\350\000\373\152\131\371\260\007\067\070"
	"\142\126\357\341\076\260\312\050\347\052\120\150\324\165\066\200"
	"\114\242\334\233\164\227\234\065\055\051\164\265\254\346\062\205"
	"\273\007\137\335\116\106\127\076\114\377\261\174\064\105\004\252"
	"\351\023\007\303\336\163\006\255\257\216\327\244\124\236\034\342"
	"\224\064\016\203\074\303\203\032\055\365\172\050\253\027\164\263"
	"\314\052\334\332\132\265\366\006\344\017\153\305\261\151\200\323"
	"\060\065\202\342\167\325\170\132\240\147\362\316\355\357\213\275"
	"\222\213\275\351\356\255\353\215\107\145\213\177\015\141\275\305"
	"\050\360\026\006\202\200\220\235\126\242\052\150\212\071\220\223"
	"\134\106\013\211\173\342\326\052\361\104\122\043\337\267\261\267"
	"\153\177\040\337\231\230\055\024\360\070\075\053\055\156\127\142"
	"\155\224\031\172\247\020\131\272\066\355\222\107\034\214\246\001"
	"\257\361\366\373\362\341\260\344\304\331\065\277\154\022\310\250"
	"\335\233\276\036\062\066\053\207\165\073\013\020\245\063\243\142"
	"\371\145\101\306\104\023\346\235\306\277\177\113\045\225\373\121"
	"\215\373\266\374\314\222\116\367\214\064\167\034\057\210\222\160"
	"\166\063\073\350\145\334\274\030\100\236\326\225\314\115\352\072"
	"\055\100\034\376\062\067\312\277\342\235\334\240\313\056\134\334"
	"\064\237\307\241\140\311\266\124\354\027\074\254\343\210\065\110"
	"\141\305\365\173\133\373\000\377\350\134\134\315\364\030\356\132"
	"\160\105\025\152\006\275\262\331\141\251\357\321\323\341\026\207"
	"\130\332\342\156\361\212\211\317\150\166\375\250\007\035\003\341"
	"\122\117\126\005\070\054\066\254\333\051\320\273\027\261\270\170"
	"\302\054\222\250\236\330\321\125\305\115\030\276\377\205\063\311"
	"\007\066\011\343\141\273\367\124\117\155\315\227\045\305\010\104"
	"\237\355\100\231\022\371\252\212\321\200\265\362\072\242\111\256"
	"\062\112\174\364\323\075\260\103\257\147\112\151\154\364\343\031"
	"\074\340\145\135\211\215\221\011\140\006\033\147\254\326\076\240"
	"\105\060\045\122\334\123\234\161\231\117\325\072\370\113\122\262"
	"\163\163\070\211\374\205\344\200\323\217\071\201\144\335\305\352"
	"\020\044\362\126\170\310\023\350\032\265\275\362\361\326\033\147"
	"\353\246\023\276\262\312\354\253\256\057\255\006\026\265\164\030"
	"\171\002\276\211\244\214\274\012\354\266\262\356\245\071\007\066"
	"\127\137\240\217\370\164\137\167\302\131\133\110\223\013\041\212"
	"\230\033\376\007\324\276\070\061\276\050\203\006\146\255\040\227"
	"\226\202\332\004\262\353\372\262\323\117\023\015\047\001\366\124"
	"\050\312\123\260\333\212\203\335\311\372\007\035\241\327\233\324"
	"\346\217\202\033\210\034\160\336\223\070\206\173\355\107\306\226"
	"\217\222\241\026\153\061\330\107\172\361\140\347\335\132\010\106"
	"\121\143\253\164\016\265\102\323\176\140\256\362\036\105\204\262"
	"\203\347\363\310\161\306\011\176\016\131\257\160\047\237\054\053"
	"\157\065\054\020\277\342\140\215\224\036\034\370\355\210\031\032"
	"\274\274\130\346\011\143\124\367\177\034\100\076\124\033\207\000"
	"\206\363\157\012\206\165\311\043\237\373\144\305\037\013\105\006"
	"\371\016\340\046\062\222\332\265\135\066\035\373\154\204\020\202"
	"\020\204\367\117\350\175\271\234\266\311\143\034\001\360\204\035"
	"\164\220\033\355\372\375\247\071\202\137\073\134\160\322\056\017"
	"\051\255\174\133\177\366\256\277\060\036\140\302\064\022\302\320"
	"\122\036\057\051\134\070\237\032\246\343\230\063\037\032\105\375"
	"\156\244\104\076\155\367\063\243\367\366\136\046\241\352\256\317"
	"\301\005\231\304\340\054\360\351\215\153\100\215\076\227\302\213"
	"\377\045\242\245\222\035\241\347\346\031\075\116\141\365\043\062"
	"\157\204\225\270\162\300\032\372\370\357\335\367\353\026\272\316"
	"\035\202\127\327\233\232\341\165\277\055\251\277\120\161\152\366"
	"\110\200\257\315\305\322\153\026\126\270\120\310\335\053\363\312"
	"\377\252\347\314\210\046\063\321\371\154\136\112\336\311\101\046"
	"\111\360\364\016\303"
#define      xecc_z	15
#define      xecc	((&data[3753]))
	"\346\370\120\240\361\155\343\202\241\113\174\312\163\245\360"
#define      msg1_z	65
#define      msg1	((&data[3775]))
	"\365\241\325\300\240\177\247\234\302\155\231\224\125\027\230\212"
	"\317\261\165\106\037\005\115\225\032\127\367\367\370\204\024\006"
	"\235\224\133\067\156\251\345\337\122\316\226\354\034\324\340\110"
	"\101\032\263\252\055\323\162\026\346\140\207\064\276\012\012\130"
	"\210\120\022\332\030\377\002\225\155\010\316\241\332\310\015\070"
	"\022\353\002\123\022\113\104"
#define      pswd_z	256
#define      pswd	((&data[3877]))
	"\146\177\042\176\365\004\164\227\332\065\070\132\334\245\142\252"
	"\106\074\162\124\165\205\142\004\221\104\257\141\136\064\073\371"
	"\165\253\236\040\267\215\207\075\062\045\331\007\024\042\231\332"
	"\337\032\315\057\153\057\063\375\164\343\136\323\030\231\314\215"
	"\104\153\256\374\370\065\072\052\132\024\062\156\066\313\111\026"
	"\345\026\105\121\106\171\116\273\134\254\216\164\106\133\002\212"
	"\306\260\207\276\345\302\351\100\326\034\257\015\350\370\043\315"
	"\017\150\036\125\342\155\021\076\031\237\262\137\373\264\352\301"
	"\144\162\200\112\064\152\212\013\206\071\030\156\061\073\074\100"
	"\244\133\226\206\310\247\305\341\106\167\101\102\054\053\003\221"
	"\235\204\333\322\356\145\335\165\236\365\344\320\061\040\020\326"
	"\173\247\135\104\116\042\046\225\231\147\327\305\223\333\126\060"
	"\140\062\002\116\227\340\304\066\325\250\006\007\311\027\335\105"
	"\276\072\211\015\134\260\242\366\027\172\274\252\125\023\333\265"
	"\105\336\004\334\276\311\023\224\162\032\234\073\061\171\200\360"
	"\264\012\376\021\272\240\007\322\033\303\174\161\327\130\047\034"
	"\066\054\371\365\365\014\212\147\046\046\242\130\240\043\111\124"
	"\056\107\145\350\350\155\100\167"
#define      tst2_z	19
#define      tst2	((&data[4136]))
	"\035\172\156\137\223\240\250\010\170\343\261\111\365\232\312\347"
	"\134\100\317\222\132\035\046"
#define      chk2_z	19
#define      chk2	((&data[4161]))
	"\100\222\115\144\277\351\254\235\003\106\210\374\327\334\371\212"
	"\235\040\344\224\215\277\264"
#define      inlo_z	3
#define      inlo	((&data[4181]))
	"\277\122\112"
#define      lsto_z	1
#define      lsto	((&data[4184]))
	"\134"
#define      tst1_z	22
#define      tst1	((&data[4190]))
	"\116\041\343\242\227\312\176\246\003\300\034\070\100\202\357\271"
	"\270\016\164\160\261\361\222\207\136\361\126\151\343"
#define      chk1_z	22
#define      chk1	((&data[4215]))
	"\321\332\032\244\251\167\321\152\005\057\213\042\115\157\162\224"
	"\001\152\264\176\173\057\312\137"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */
#define BUSYBOXON	0	/* Define as 1 to enable work with busybox */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

void chkenv_end(void);

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask = (unsigned long)getpid();
	stte_0();
	 key(&chkenv, (void*)&chkenv_end - (void*)&chkenv);
	 key(&data, sizeof(data));
	 key(&mask, sizeof(mask));
	arc4(&mask, sizeof(mask));
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

void chkenv_end(void){}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];
	if (me == NULL) { me = getenv("_"); }
	if (me == 0) { fprintf(stderr, "E: neither argv[0] nor $_ works."); exit(1); }

	ret = chkenv(argc);
	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
#if BUSYBOXON
	varg[j++] = "busybox";
	varg[j++] = "sh";
#else
	varg[j++] = argv[0];		/* My own name at execution */
#endif
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
